<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TID Challenge – Play</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body>

  <!-- Choose method screen -->
  <div class="screen active" id="choose-box-screen">
    <h2>How do you want to start?</h2>
    <button onclick="showBoxIdInput()">Enter Box ID</button>
    <button onclick="startQRScanner()">Scan QR Code</button>
  </div>

  <!-- Manual Box ID + QR scan screen -->
  <div class="screen hidden" id="start-screen">
    <h2>Enter Your Challenge Box ID</h2>
    <input type="text" id="boxIdInput" placeholder="Enter Box ID" />
    <button onclick="startChallenge()">Start</button>
    <div id="qr-reader" style="width: 300px; margin-top: 20px; display: none;"></div>
  </div>

  <!-- Challenge guessing screen -->
  <div class="screen hidden" id="guess-screen">
    <h2>What’s in the box?</h2>
    <div id="choices"></div>
    <div id="hint-buttons" class="hidden">
      <button onclick="showHint(1)" class="hidden">Hint 1</button>
      <button onclick="showHint(2)" class="hidden">Hint 2</button>
      <button onclick="showTID()" class="hidden">Show TID Hint</button>
    </div>
    <div id="hint-container" class="hidden">
      <video id="hintVideo" controls></video>
    </div>
  </div>

  <!-- Correct screen -->
  <div class="screen hidden" id="success-screen">
    <h2>Correct!</h2>
    <img id="itemImage" src="" alt="Item" />
    <p id="itemDescription"></p>
    <button onclick="showLeaderboard()">Show Leaderboard</button>
  </div>

  <!-- Leaderboard screen -->
  <div class="screen hidden" id="leaderboard-screen">
    <h2>Leaderboard</h2>
    <ul id="leaderboardList"></ul>
    <button onclick="showScreen('choose-box-screen')">Back</button>
  </div>

  <!-- TID modal -->
  <div class="modal hidden" id="tidModal">
    <div class="modal-content">
      <span class="close" onclick="closeTIDModal()">&times;</span>
      <p id="tidResult"></p>
    </div>
  </div>

  <script src="script.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const name = localStorage.getItem("playerName");
      const model = localStorage.getItem("detectorModel");
      if (!name || !model) {
        alert("Missing player information. Redirecting...");
        window.location.href = "index.html";
        return;
      }

      // Only show mode selection on load
      showScreen("choose-box-screen");
    });
  </script>

</body>
</html>
